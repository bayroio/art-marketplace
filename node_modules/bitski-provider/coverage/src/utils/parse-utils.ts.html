<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/utils/parse-utils.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">src/utils</a> parse-utils.ts
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">78.79% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>26/33</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">62.5% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>15/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/3</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">78.79% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>26/33</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</td><td class="line-coverage quiet"><span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-yes">12x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-yes">14x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-yes">13x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import BN from 'bn.js';
&nbsp;
/**
 * parseNumber
 * Converts a value that represents a number into a hex value.
 * @param arg {string | number | BN} A number value to convert to hex.
 * Can be a regular number, base-10 string, base-16 string, or BN instance.
 * @returns {BN} BN instance representing the number
 *
 * (Adapted from ethereumjs-abi)
 */
function parseNumber(arg: string | number | BN): BN {
  const type = typeof arg;
  if (type === 'string') {
    if (arg.substr(0, 2) === '0x') {
      return new BN(arg.substr(2), 16);
    } else {
      return new BN(arg, 10);
    }
  } else <span class="missing-if-branch" title="else path not taken" >E</span>if (type === 'number') {
    return new BN(arg);
  } else <span class="cstat-no" title="statement not covered" >if (arg.toArray) {</span>
    // assume this is a BN for the moment, replace with BN.isBN soon
<span class="cstat-no" title="statement not covered" >    return arg;</span>
  } else {
<span class="cstat-no" title="statement not covered" >    throw new Error('Argument is not a number');</span>
  }
}
&nbsp;
function parseBitWidth(type: string, offset: number): number {
  // default to 256 bit if not specified
  let size = 256;
  // If type string is longer than offset, parse bits from the type string
  <span class="missing-if-branch" title="else path not taken" >E</span>if (type.length &gt; offset) {
    size = parseInt(type.substr(offset), 10);
  }
  // bit width must be a multiple of 8, and in the range 8-256.
  <span class="missing-if-branch" title="if path not taken" >I</span>if (size % 8 || size &lt; 8 || size &gt; 256) {
<span class="cstat-no" title="statement not covered" >    throw new Error(`Invalid bit width ${type}`);</span>
  }
  return size;
}
/**
 * encodeNumber
 * Takes a decimal string, hex string, regular number, or BN instance and returns a hex string in the specified format.
 * Typically these conversions are done in web3, but until web3 adds direct support, this is necessary for normalizing
 * numbers eth_signTypedData payloads.
 * @param num The value to convert
 * @param type The solidity ABI type to format the data as (eg. uint256, int8, etc). Only supports int and uint variants.
 * @param compact boolean (default false). Whether to use compact encoding for uints, or pad with zeroes.
 * @returns {string} A hex string formatted as the specified type.
 */
export function encodeNumber(num: string | number | BN, type: string, compact: boolean = <span class="branch-0 cbranch-no" title="branch not covered" >false)</span>: string {
  if (type.startsWith('uint')) {
    const size = parseBitWidth(type, 4); // start after 'uint'
    const length = size / 4; // length in characters for the string. hex is 1 character for 4 bits.
    const parsed = parseNumber(num);
    // uint can never be negative
    <span class="missing-if-branch" title="if path not taken" >I</span>if (parsed.isNeg()) {
<span class="cstat-no" title="statement not covered" >      throw new Error('Supplied uint is negative');</span>
    }
    // Convert to hex, and prepend 0x
    <span class="missing-if-branch" title="else path not taken" >E</span>if (compact) {
      return '0x' + parsed.toString(16);
    }
<span class="cstat-no" title="statement not covered" >    return '0x' + parsed.toString(16, length);</span>
  } else <span class="missing-if-branch" title="else path not taken" >E</span>if (type.startsWith('int')) {
    // bit width must be a multiple of 8, and in the range 8-256.
    const size = parseBitWidth(type, 3);
    const length = size / 4; // length in characters for the string. hex is 1 character for 4 bits.
    const parsed = parseNumber(num);
    // Convert to twos complement at the bit size from the type, then convert value to hex
    return '0x' + parsed.toTwos(size).toString(16, length);
  } else {
<span class="cstat-no" title="statement not covered" >    throw new Error('Invalid type passed');</span>
  }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Oct 28 2019 15:42:23 GMT-0700 (Pacific Daylight Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
